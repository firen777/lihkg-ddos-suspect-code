webpackJsonp([15],{1039:function(e,t,r){"use strict";function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function o(n,i){try{var a=t[n](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){o("next",e)},function(e){o("throw",e)});e(s)}return o("next")})}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=r(14),c=r.n(s),l=r(1),f=r.n(l),p=r(69),b=r.n(p),u=r(5),d=r(3),h=r(18),w=r(1100),m=r.n(w),x="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),y={},k={blob:null,rect:null,nsfwScore:0,isLoading:!0,isImage:!1},v=function(e){return{linkHoverPreview:Object(h.d)(e).linkHoverPreview,isMobile:e.app.isMobile,linkPreviewData:e.ui.linkPreviewData}},R=function(e){function t(){var e,r,o,a;n(this,t);for(var s=arguments.length,c=Array(s),l=0;l<s;l++)c[l]=arguments[l];return r=o=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),o.state=k,o.renderPreview=function(){var e=o.state,t=e.blob,r=e.rect,n=e.nsfwScore,i=e.isLoading,a=Math.min(.5*window.innerHeight,.5*window.innerWidth),s={};return s.left=r.left+r.width/2,s.top=r.top+r.height+16,s.top+a>window.innerHeight&&(delete s.top,delete s.marginTop,s.bottom=window.innerHeight-r.top+16),f.a.createElement("div",{className:m.a.preview+" "+(s.top?m.a.topArrow:m.a.bottomArrow),style:s},i?f.a.createElement(d.o,{size:20}):f.a.createElement("div",{className:m.a.imageContainer},f.a.createElement("img",{alt:"",src:t,style:Object.assign({maxHeight:a,maxWidth:a},n>.85?{filter:"blur(15px)"}:{})})),i||n<.85||f.a.createElement("div",{className:m.a.sensitive},f.a.createElement("i",{className:"i-censored"}),f.a.createElement("span",null,"\u53ef\u80fd\u542b\u6709\u4e0d\u96c5\u5167\u5bb9")))},a=r,i(o,a)}return a(t,e),g(t,[{key:"componentDidUpdate",value:function(e){var t=this,r=this.props,n=r.isMobile,i=r.linkPreviewData;if(!n&&e.linkPreviewData!==i){var a=i.url,s=i.rect;if(this.setState({rect:s,blob:null,nsfwScore:0,isLoading:!0,isImage:!1}),a&&s&&!1!==y[a]){if("object"===x(y[a])){var l=y[a],f=l.blob,p=l.score;return void this.setState({blob:f,nsfwScore:p,isLoading:!1,isImage:!0})}new Promise(function(){var e=o(c.a.mark(function e(r,o){var n,i,s,l;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,e.next=3,b()({url:"https://i.lihkg.com/1/"+a,method:"head"});case 3:if(n=e.sent,200===n.status){e.next=7;break}return o(new Error("Invalid status "+n.status)),e.abrupt("return");case 7:if(i=n.headers["content-type"],i.startsWith("image/")){e.next=11;break}return o(new Error("Invalid content type "+i)),e.abrupt("return");case 11:return t.setState({isImage:!0}),e.next=14,b()({url:"https://i.lihkg.com/540/"+a,method:"get",responseType:"blob"});case 14:n=e.sent,s=n.headers["nsfw-score"],s=s?parseFloat(s):0,l=window.URL.createObjectURL(n.data),y[a]={blob:l,score:s},r({blob:l,nsfwScore:s,isLoading:!1});case 20:case"end":return e.stop()}},e,t)}));return function(t,r){return e.apply(this,arguments)}}()).then(function(e){return t.setState(e)}).catch(function(){y[a]=!1,t.setState(k)})}}}},{key:"render",value:function(){var e=this.state,t=e.rect,r=e.isImage;return this.props.linkHoverPreview&&t&&r?this.renderPreview():null}}]),t}(f.a.Component);t.default=Object(u.b)(v)(R)},1100:function(e,t,r){var o=r(1101);"string"===typeof o&&(o=[[e.i,o,""]]);var n={hmr:!0};n.transform=void 0,n.insertInto=void 0;r(1032)(o,n);o.locals&&(e.exports=o.locals)},1101:function(e,t,r){t=e.exports=r(1031)(!1),t.push([e.i,'._1Rb5hzxfh3kwe9QXjPVRZ0{-webkit-align-items:center;-ms-flex-align:center;align-items:center;background:#fff;border:1px solid #999;border-radius:4px;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;min-height:64px;min-width:64px;padding:4px;pointer-events:none;position:fixed;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%);z-index:100}[data-app-dm] ._1Rb5hzxfh3kwe9QXjPVRZ0{background:#222;border-color:#777}._1Rb5hzxfh3kwe9QXjPVRZ0:after,._1Rb5hzxfh3kwe9QXjPVRZ0:before{border:0 solid transparent;content:"";left:50%;position:absolute}._1Rb5hzxfh3kwe9QXjPVRZ0:before{border-width:9px;margin-left:-9px}._1Rb5hzxfh3kwe9QXjPVRZ0:after{border-width:8px;margin-left:-8px}._1Rb5hzxfh3kwe9QXjPVRZ0._1W0btuS97j7c_wx6BNgkBY:before{border-bottom-color:#999;top:-18px}[data-app-dm] ._1Rb5hzxfh3kwe9QXjPVRZ0._1W0btuS97j7c_wx6BNgkBY:before{border-bottom-color:#777}._1Rb5hzxfh3kwe9QXjPVRZ0._14l3aLYdyw0LREJ9XSRFhE:before{border-top-color:#999;bottom:-18px}[data-app-dm] ._1Rb5hzxfh3kwe9QXjPVRZ0._14l3aLYdyw0LREJ9XSRFhE:before{border-top-color:#777}._1Rb5hzxfh3kwe9QXjPVRZ0._1W0btuS97j7c_wx6BNgkBY:after{border-bottom-color:#fff;top:-16px}[data-app-dm] ._1Rb5hzxfh3kwe9QXjPVRZ0._1W0btuS97j7c_wx6BNgkBY:after{border-bottom-color:#222}._1Rb5hzxfh3kwe9QXjPVRZ0._14l3aLYdyw0LREJ9XSRFhE:after{border-top-color:#fff;bottom:-16px}[data-app-dm] ._1Rb5hzxfh3kwe9QXjPVRZ0._14l3aLYdyw0LREJ9XSRFhE:after{border-top-color:#222}._1Rb5hzxfh3kwe9QXjPVRZ0>._373upDx6Hxdx3UCdg6jDoi{overflow:hidden}._1Rb5hzxfh3kwe9QXjPVRZ0>._373upDx6Hxdx3UCdg6jDoi>img{vertical-align:bottom}._1Rb5hzxfh3kwe9QXjPVRZ0 .io7e5wpz4cP6PV-pfcgB7{-webkit-align-items:center;-ms-flex-align:center;align-items:center;background:rgba(0,0,0,.3);bottom:4px;color:#fff;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;font-size:.8rem;font-weight:700;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;left:4px;position:absolute;right:4px;text-shadow:0 1px 4px #000;top:4px}._1Rb5hzxfh3kwe9QXjPVRZ0 .io7e5wpz4cP6PV-pfcgB7>i{font-size:4.2rem;font-weight:100;height:3rem;line-height:3rem}',""]),t.locals={preview:"_1Rb5hzxfh3kwe9QXjPVRZ0",topArrow:"_1W0btuS97j7c_wx6BNgkBY",bottomArrow:"_14l3aLYdyw0LREJ9XSRFhE",imageContainer:"_373upDx6Hxdx3UCdg6jDoi",sensitive:"io7e5wpz4cP6PV-pfcgB7"}}});